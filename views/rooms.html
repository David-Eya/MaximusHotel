<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rooms Management - Maximus Hotel</title>
    <link rel="icon" href="/MaximusHotel/img/favicon.png" />
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/MaximusHotel/css/admin.css">
    
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="rooms-page">
    <div class="sidebar">
        <div class="sidebar-header">
            <h4><img src="/MaximusHotel/img/favicon.png" alt="M" class="logo-letter">aximus Hotel</h4>
        </div>
        <nav class="sidebar-nav">
            <a href="/MaximusHotel/views/index.html" class="nav-item">
                <i class="fas fa-chart-line"></i> Dashboard
            </a>
            <a href="/MaximusHotel/views/users.html" class="nav-item" id="navUsers" style="display: none;">
                <i class="fas fa-users"></i> Users
            </a>
            <a href="/MaximusHotel/views/bookings.html" class="nav-item">
                <i class="fas fa-calendar-check"></i> Bookings
            </a>
            <a href="/MaximusHotel/views/rooms.html" class="nav-item active">
                <i class="fas fa-bed"></i> Rooms
            </a>
            <a href="/MaximusHotel/views/room-categories.html" class="nav-item" id="navRoomCategories" style="display: none;">
                <i class="fas fa-tags"></i> Room Categories
            </a>
            <a href="/MaximusHotel/views/profile.html" class="nav-item">
                <i class="fas fa-user"></i> My Profile
            </a>
            <a href="#" id="adminLogout" class="nav-item">
                <i class="fas fa-sign-out-alt"></i> Logout
            </a>
        </nav>
    </div>

    <div class="main-content">
        <div class="top-bar">
            <div class="d-flex align-items-center gap-3">
                <button class="btn btn-outline-light d-md-none" id="sidebarToggle" style="background: #084466; border-color: #084466; color: white;">
                    <i class="fas fa-bars"></i>
                </button>
                <h2 class="mb-0">Rooms Management</h2>
            </div>
            <div class="user-info">
                <div class="user-details">
                    <span id="adminUserName">Admin</span>
                    <span id="adminUserType" class="user-type">Admin</span>
                </div>
                <a href="/MaximusHotel/views/profile.html" style="text-decoration: none; color: inherit;">
                    <img id="adminProfileImage" src="/MaximusHotel/profile_img/default.jpg" alt="Admin" style="width: 50px; height: 50px; border-radius: 50%; object-fit: cover; border: 2px solid #084466; display: none; cursor: pointer;">
                    <i class="fas fa-user-circle" id="adminProfileIcon" style="font-size: 2rem; cursor: pointer;"></i>
                </a>
            </div>
        </div>

        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">All Rooms</h5>
                <div class="d-flex gap-2 align-items-center" style="flex-wrap: nowrap;">
                    <select class="form-control" id="categoryFilter" style="width: 200px; flex-shrink: 0;">
                        <option value="">All Categories</option>
                    </select>
                    <select class="form-control" id="statusFilter" style="width: 200px; flex-shrink: 0;">
                        <option value="">All Status</option>
                        <option value="available">Available</option>
                        <option value="occupied">Occupied</option>
                        <option value="maintenance">Maintenance</option>
                    </select>
                    <div class="input-group" style="flex: 1 1 auto; min-width: 200px; max-width: 400px;">
                        <input type="text" class="form-control" id="searchRooms" placeholder="Search rooms...">
                        <button class="btn btn-outline-secondary" type="button" id="searchBtn">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#roomModal" onclick="openRoomModal()" style="flex-shrink: 0; white-space: nowrap;">
                        <i class="fas fa-plus"></i> Add Room
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Room ID</th>
                                <th>Category</th>
                                <th>Status</th>
                                <th>Created At</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="roomsTableBody">
                            <tr><td colspan="5" class="text-center">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
                <nav>
                    <ul class="pagination justify-content-center" id="roomsPagination"></ul>
                </nav>
            </div>
        </div>
    </div>

    <!-- Room Modal -->
    <div class="modal fade" id="roomModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="roomModalTitle">Add Room</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="roomForm">
                        <input type="hidden" id="originalRoomId">
                        <div class="mb-3">
                            <label class="form-label">Room ID *</label>
                            <input type="text" class="form-control" id="roomId" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Category *</label>
                            <select class="form-control" id="categoryId" required>
                                <option value="">Select Category</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Status *</label>
                            <select class="form-control" id="status" required>
                                <option value="available">Available</option>
                                <option value="occupied">Occupied</option>
                                <option value="maintenance">Maintenance</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveRoom()">Save Room</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/MaximusHotel/js/auth.js"></script>
    <script src="/MaximusHotel/js/admin-auth.js"></script>
    <script src="/MaximusHotel/js/admin-api.js"></script>
    <script>
        const Toast = Swal.mixin({
            toast: true,
            position: 'top-end',
            showConfirmButton: false,
            timer: 3000
        });

        let currentPage = 1;
        const limit = 10;
        let categories = [];
        let allRooms = []; // Store all rooms for calculating next ID

        // Function to get the next available room ID
        async function getNextRoomId() {
            try {
                const result = await adminAPI.getNextRoomId();
                if (result.success && result.next_room_id) {
                    return result.next_room_id;
                }
                
                // Fallback: try to get from currently loaded rooms
                if (allRooms.length > 0) {
                    const maxRoomId = Math.max(...allRooms.map(room => {
                        const roomId = parseInt(room.room_id);
                        return isNaN(roomId) ? 0 : roomId;
                    }));
                    return maxRoomId + 1;
                }
                return 1; // Default to 1 if all else fails
            } catch (error) {
                console.error('Error getting next room ID:', error);
                // Fallback: try to get from currently loaded rooms
                if (allRooms.length > 0) {
                    const maxRoomId = Math.max(...allRooms.map(room => {
                        const roomId = parseInt(room.room_id);
                        return isNaN(roomId) ? 0 : roomId;
                    }));
                    return maxRoomId + 1;
                }
                return 1; // Default to 1 if all else fails
            }
        }

        async function loadCategories() {
            const result = await adminAPI.getRoomCategories();
            if (result.success) {
                // Handle response structure - API returns data array
                categories = result.data || result.categories || [];
                
                // Populate modal category dropdown
                const select = document.getElementById('categoryId');
                if (select) {
                    select.innerHTML = '<option value="">Select Category</option>';
                    categories.forEach(cat => {
                        select.innerHTML += `<option value="${cat.category_id}">${cat.category_name}</option>`;
                    });
                }
                
                // Populate filter category dropdown with all categories
                populateCategoryFilter();
            }
        }

        async function openRoomModal(room = null) {
            const modal = new bootstrap.Modal(document.getElementById('roomModal'));
            const roomIdInput = document.getElementById('roomId');
            document.getElementById('roomForm').reset();
            document.getElementById('originalRoomId').value = '';
            document.getElementById('roomModalTitle').textContent = 'Add Room';

            if (room) {
                // Editing existing room
                document.getElementById('roomModalTitle').textContent = 'Edit Room';
                document.getElementById('originalRoomId').value = room.room_id;
                roomIdInput.value = room.room_id;
                roomIdInput.removeAttribute('readonly');
                roomIdInput.style.backgroundColor = '';
                document.getElementById('categoryId').value = room.category_id;
                document.getElementById('status').value = room.status;
            } else {
                // Adding new room - auto-generate room ID
                roomIdInput.setAttribute('readonly', 'readonly');
                roomIdInput.style.backgroundColor = '#e9ecef';
                roomIdInput.value = 'Loading...';
                
                // Get next room ID
                const nextRoomId = await getNextRoomId();
                roomIdInput.value = nextRoomId;
            }
            modal.show();
        }

        // Helper function to properly close modal and remove backdrop
        function closeModal(modalId) {
            const modalElement = document.getElementById(modalId);
            if (!modalElement) return;
            
            // Get or create modal instance
            let modal = bootstrap.Modal.getInstance(modalElement);
            if (!modal) {
                modal = new bootstrap.Modal(modalElement);
            }
            
            // Hide the modal
            modal.hide();
            
            // Cleanup function - wait for Bootstrap's animation to complete
            const performCleanup = () => {
                // Check if modal is actually hidden (no show class and not in transition)
                const isModalHidden = !modalElement.classList.contains('show') && 
                                     modalElement.style.display === 'none' || 
                                     !modalElement.classList.contains('show');
                
                if (isModalHidden) {
                    // Remove all backdrops
                    const backdrops = document.querySelectorAll('.modal-backdrop');
                    backdrops.forEach(backdrop => {
                        // Only remove if no modals are showing
                        const showingModals = document.querySelectorAll('.modal.show');
                        if (showingModals.length === 0) {
                            backdrop.remove();
                        }
                    });
                    
                    // Only remove modal-open if no modals are showing
                    const showingModals = document.querySelectorAll('.modal.show');
                    if (showingModals.length === 0) {
                        document.body.classList.remove('modal-open');
                        document.body.style.overflow = '';
                        document.body.style.paddingRight = '';
                    }
                }
            };
            
            // Wait for Bootstrap's fade animation (usually 150ms) plus a buffer
            setTimeout(performCleanup, 350);
            
            // Also listen for the hidden event (fires after animation completes)
            const cleanupHandler = function() {
                performCleanup();
                modalElement.removeEventListener('hidden.bs.modal', cleanupHandler);
            };
            modalElement.addEventListener('hidden.bs.modal', cleanupHandler, { once: true });
        }
        
        // Global cleanup function that runs periodically to catch any missed backdrops
        function cleanupModalBackdrops() {
            // Only cleanup if no modals are showing or in transition
            const showingModals = document.querySelectorAll('.modal.show');
            
            // If no modals are showing, remove orphaned backdrops
            if (showingModals.length === 0) {
                // Wait a bit to ensure transition is complete
                setTimeout(() => {
                    const stillShowing = document.querySelectorAll('.modal.show');
                    if (stillShowing.length === 0) {
                        const backdrops = document.querySelectorAll('.modal-backdrop');
                        if (backdrops.length > 0) {
                            backdrops.forEach(backdrop => backdrop.remove());
                            document.body.classList.remove('modal-open');
                            document.body.style.overflow = '';
                            document.body.style.paddingRight = '';
                        }
                    }
                }, 100);
            }
        }
        
        // Run cleanup check every 500ms (less aggressive)
        setInterval(cleanupModalBackdrops, 500);

        async function saveRoom() {
            const originalRoomId = document.getElementById('originalRoomId').value;
            const roomData = {
                room_id: document.getElementById('roomId').value,
                category_id: parseInt(document.getElementById('categoryId').value),
                status: document.getElementById('status').value
            };

            if (originalRoomId) {
                roomData.original_room_id = originalRoomId;
                const result = await adminAPI.updateRoom(roomData);
                if (result.success) {
                    closeModal('roomModal');
                    // Wait a bit for modal to close before showing toast
                    setTimeout(() => {
                        Toast.fire({ icon: 'success', title: 'Room updated successfully' });
                        const search = document.getElementById('searchRooms').value;
                        const categoryId = document.getElementById('categoryFilter').value;
                        const status = document.getElementById('statusFilter').value;
                        loadRooms(search, categoryId, status);
                    }, 100);
                } else {
                    Toast.fire({ icon: 'error', title: result.message || 'Failed to update room' });
                }
            } else {
                const result = await adminAPI.createRoom(roomData);
                if (result.success) {
                    closeModal('roomModal');
                    // Wait a bit for modal to close before showing toast
                    setTimeout(() => {
                        Toast.fire({ icon: 'success', title: 'Room created successfully' });
                        const search = document.getElementById('searchRooms').value;
                        const categoryId = document.getElementById('categoryFilter').value;
                        const status = document.getElementById('statusFilter').value;
                        loadRooms(search, categoryId, status);
                    }, 100);
                } else {
                    Toast.fire({ icon: 'error', title: result.message || 'Failed to create room' });
                }
            }
        }

        async function loadRooms(search = '', categoryId = '', status = '') {
            try {
                const result = await adminAPI.getRooms(search, limit, currentPage, categoryId, status);
                if (result.success) {
                    // Handle response structure - API returns data and pagination
                    const rooms = result.data || result.rooms || [];
                    const pagination = result.pagination || {};
                    
                    // Store rooms for calculating next ID
                    allRooms = rooms;
                    
                    updateRoomsTable(rooms);
                    updatePagination(
                        pagination.total_items || result.total || 0,
                        pagination.current_page || result.page || currentPage,
                        pagination.items_per_page || result.limit || limit
                    );
                } else {
                    Toast.fire({ icon: 'error', title: result.message || 'Failed to load rooms' });
                }
            } catch (error) {
                console.error('Error loading rooms:', error);
                Toast.fire({ icon: 'error', title: 'Failed to load rooms' });
            }
        }

        function formatStatus(status) {
            if (!status) return '';
            // Capitalize first letter and make rest lowercase
            return status.charAt(0).toUpperCase() + status.slice(1).toLowerCase();
        }

        function updateRoomsTable(rooms) {
            const tbody = document.getElementById('roomsTableBody');
            if (rooms.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="text-center">No rooms found</td></tr>';
                return;
            }

            tbody.innerHTML = rooms.map(room => {
                // Convert status to lowercase for comparison
                const statusLower = (room.status || '').toLowerCase();
                const statusClass = {
                    'available': 'success',
                    'occupied': 'danger',
                    'maintenance': 'warning'
                }[statusLower] || 'secondary';

                return `
                    <tr>
                        <td>${room.room_id}</td>
                        <td>${room.category_name}</td>
                        <td><span class="badge bg-${statusClass}">${formatStatus(room.status)}</span></td>
                        <td>${new Date(room.created_at).toLocaleDateString()}</td>
                        <td>
                            <button class="btn btn-sm btn-primary" onclick="openRoomModal(${JSON.stringify(room).replace(/"/g, '&quot;')})">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteRoom('${room.room_id}')">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function updatePagination(total, page, limit) {
            const totalPages = Math.ceil(total / limit);
            const pagination = document.getElementById('roomsPagination');
            pagination.innerHTML = '';

            if (totalPages <= 1) {
                return;
            }

            const search = document.getElementById('searchRooms').value;
            const categoryId = document.getElementById('categoryFilter').value;
            const status = document.getElementById('statusFilter').value;

            // Previous button
            const prevLi = document.createElement('li');
            prevLi.className = `page-item ${page === 1 ? 'disabled' : ''}`;
            prevLi.innerHTML = `<a class="page-link" href="#" onclick="if (currentPage > 1) { currentPage--; loadRooms('${search}', '${categoryId}', '${status}'); } return false;">Previous</a>`;
            pagination.appendChild(prevLi);

            // Page numbers with ellipsis
            const maxVisible = 5;
            let startPage = Math.max(1, page - Math.floor(maxVisible / 2));
            let endPage = Math.min(totalPages, startPage + maxVisible - 1);

            if (endPage - startPage < maxVisible - 1) {
                startPage = Math.max(1, endPage - maxVisible + 1);
            }

            // First page
            if (startPage > 1) {
                const firstLi = document.createElement('li');
                firstLi.className = 'page-item';
                firstLi.innerHTML = `<a class="page-link" href="#" onclick="currentPage = 1; loadRooms('${search}', '${categoryId}', '${status}'); return false;">1</a>`;
                pagination.appendChild(firstLi);

                if (startPage > 2) {
                    const ellipsisLi = document.createElement('li');
                    ellipsisLi.className = 'page-item disabled';
                    ellipsisLi.innerHTML = `<span class="page-link">...</span>`;
                    pagination.appendChild(ellipsisLi);
                }
            }

            // Page range
            for (let i = startPage; i <= endPage; i++) {
                const li = document.createElement('li');
                li.className = `page-item ${i === page ? 'active' : ''}`;
                li.innerHTML = `<a class="page-link" href="#" onclick="currentPage = ${i}; loadRooms('${search}', '${categoryId}', '${status}'); return false;">${i}</a>`;
                pagination.appendChild(li);
            }

            // Last page
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    const ellipsisLi = document.createElement('li');
                    ellipsisLi.className = 'page-item disabled';
                    ellipsisLi.innerHTML = `<span class="page-link">...</span>`;
                    pagination.appendChild(ellipsisLi);
                }

                const lastLi = document.createElement('li');
                lastLi.className = 'page-item';
                lastLi.innerHTML = `<a class="page-link" href="#" onclick="currentPage = ${totalPages}; loadRooms('${search}', '${categoryId}', '${status}'); return false;">${totalPages}</a>`;
                pagination.appendChild(lastLi);
            }

            // Next button
            const nextLi = document.createElement('li');
            nextLi.className = `page-item ${page === totalPages ? 'disabled' : ''}`;
            nextLi.innerHTML = `<a class="page-link" href="#" onclick="if (currentPage < ${totalPages}) { currentPage++; loadRooms('${search}', '${categoryId}', '${status}'); } return false;">Next</a>`;
            pagination.appendChild(nextLi);
        }

        // Populate category filter dropdown with all room categories
        function populateCategoryFilter() {
            const categoryFilter = document.getElementById('categoryFilter');
            if (!categoryFilter) return;
            
            // Clear existing options except "All Categories"
            categoryFilter.innerHTML = '<option value="">All Categories</option>';
            
            // Populate with all categories
            if (categories && categories.length > 0) {
                categories.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat.category_id;
                    option.textContent = cat.category_name;
                    categoryFilter.appendChild(option);
                });
            }
        }

        async function deleteRoom(room_id) {
            const result = await Swal.fire({
                title: 'Delete Room?',
                text: 'This action cannot be undone!',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#dc3545',
                cancelButtonColor: '#6c757d',
                confirmButtonText: 'Yes, delete it'
            });

            if (result.isConfirmed) {
                const apiResult = await adminAPI.deleteRoom(room_id);
                if (apiResult.success) {
                    Toast.fire({ icon: 'success', title: 'Room deleted successfully' });
                    const search = document.getElementById('searchRooms').value;
                    const categoryId = document.getElementById('categoryFilter').value;
                    const status = document.getElementById('statusFilter').value;
                    loadRooms(search, categoryId, status);
                } else {
                    Toast.fire({ icon: 'error', title: apiResult.message || 'Failed to delete room' });
                }
            }
        }

        // Live search with debouncing
        let searchTimeout;
        function applyFilters(immediate = false) {
            if (immediate) {
                clearTimeout(searchTimeout);
                const search = document.getElementById('searchRooms').value;
                const categoryId = document.getElementById('categoryFilter').value;
                const status = document.getElementById('statusFilter').value;
                currentPage = 1;
                loadRooms(search, categoryId, status);
            } else {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    const search = document.getElementById('searchRooms').value;
                    const categoryId = document.getElementById('categoryFilter').value;
                    const status = document.getElementById('statusFilter').value;
                    currentPage = 1;
                    loadRooms(search, categoryId, status);
                }, 300); // Wait 300ms after user stops typing
            }
        }

        // Live search input - triggers on every keystroke with debouncing
        document.getElementById('searchRooms').addEventListener('input', () => {
            applyFilters(false); // Use debouncing for text input
        });
        
        // Live category filter - triggers immediately on change (no debouncing for dropdowns)
        document.getElementById('categoryFilter').addEventListener('change', () => {
            currentPage = 1;
            applyFilters(true); // Apply immediately for dropdown changes
        });

        // Live status filter - triggers immediately on change (no debouncing for dropdowns)
        document.getElementById('statusFilter').addEventListener('change', () => {
            currentPage = 1;
            applyFilters(true); // Apply immediately for dropdown changes
        });

        // Keep search button for manual trigger if needed
        document.getElementById('searchBtn').addEventListener('click', () => {
            currentPage = 1;
            applyFilters(true); // Apply immediately when button is clicked
        });

        document.getElementById('adminLogout').addEventListener('click', async (e) => {
            e.preventDefault();
            const result = await Swal.fire({
                title: 'Logout?',
                text: 'Are you sure you want to logout?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#dc3545',
                cancelButtonColor: '#6c757d',
                confirmButtonText: 'Yes, logout'
            });

            if (result.isConfirmed) {
                const auth = new Auth();
                await auth.logout();
                Swal.fire({
                    icon: 'success',
                    title: 'Logout Successful',
                    text: 'You have been logged out successfully',
                    confirmButtonText: 'OK',
                    confirmButtonColor: '#084466',
                    allowOutsideClick: false,
                    timer: 1500,
                    timerProgressBar: true
                }).then(() => {
                    window.location.href = '/login.html';
                });
            }
        });

        // Toggle sidebar on mobile
        document.getElementById('sidebarToggle')?.addEventListener('click', () => {
            const sidebar = document.querySelector('.sidebar');
            sidebar.classList.toggle('open');
            document.body.classList.toggle('sidebar-open');
        });

        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', (e) => {
            const sidebar = document.querySelector('.sidebar');
            const toggle = document.getElementById('sidebarToggle');
            if (window.innerWidth <= 768 && sidebar.classList.contains('open')) {
                if (!sidebar.contains(e.target) && e.target !== toggle && !toggle?.contains(e.target)) {
                    sidebar.classList.remove('open');
                    document.body.classList.remove('sidebar-open');
                }
            }
        });

        // Update admin profile image
        function updateAdminProfileImage(userData) {
            const profileImage = document.getElementById('adminProfileImage');
            const profileIcon = document.getElementById('adminProfileIcon');
            
            if (userData && userData.image) {
                profileImage.src = `/profile_img/${userData.image}`;
                profileImage.style.display = 'block';
                if (profileIcon) profileIcon.style.display = 'none';
            } else {
                profileImage.src = '/MaximusHotel/profile_img/default.jpg';
                profileImage.style.display = 'block';
                if (profileIcon) profileIcon.style.display = 'none';
            }
        }

        // Hide menu items for incharge users
        function updateSidebarNavigation() {
            const userData = new Auth().getUser();
            if (userData && userData.usertype === 'Incharge') {
                const navUsers = document.getElementById('navUsers');
                const navRoomCategories = document.getElementById('navRoomCategories');
                if (navUsers) navUsers.style.display = 'none';
                if (navRoomCategories) navRoomCategories.style.display = 'none';
            } else {
                const navUsers = document.getElementById('navUsers');
                const navRoomCategories = document.getElementById('navRoomCategories');
                if (navUsers) navUsers.style.display = '';
                if (navRoomCategories) navRoomCategories.style.display = '';
            }
        }

        window.onAdminReady = async () => {
            const userData = new Auth().getUser();
            if (userData) {
                document.getElementById('adminUserName').textContent = userData.fname || 'Admin';
                document.getElementById('adminUserType').textContent = userData.usertype || 'Admin';
                updateAdminProfileImage(userData);
            }
            updateSidebarNavigation();
            await loadCategories(); // This will call populateCategoryFilter() internally
            loadRooms('', '', ''); // Load with empty filters initially
        };
    </script>
</body>
</html>





