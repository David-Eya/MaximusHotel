
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="Maximus - Room Booking">
    <meta name="keywords" content="itp4">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Maximus - Room Booking</title>
    <link rel="icon" href="/MaximusHotel/img/favicon.png" />
    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css?family=Lora:400,700&amp;display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Cabin:400,500,600,700&amp;display=swap" rel="stylesheet">

    <!-- Css Styles -->
    <link rel="stylesheet" href="/MaximusHotel/css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="/MaximusHotel/css/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="/MaximusHotel/css/elegant-icons.css" type="text/css">
    <link rel="stylesheet" href="/MaximusHotel/css/flaticon.css" type="text/css">
    <link rel="stylesheet" href="/MaximusHotel/css/owl.carousel.min.css" type="text/css">
    <link rel="stylesheet" href="/MaximusHotel/css/nice-select.css" type="text/css">
    <link rel="stylesheet" href="/MaximusHotel/css/jquery-ui.min.css" type="text/css">
    <link rel="stylesheet" href="/MaximusHotel/css/magnific-popup.css" type="text/css">
    <link rel="stylesheet" href="/MaximusHotel/css/slicknav.min.css" type="text/css">
    <link rel="stylesheet" href="/MaximusHotel/css/style.css" type="text/css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        const Toast = Swal.mixin({
            toast: true,
            position: 'top-end',
            showConfirmButton: false,
            timer: 3000,
            timerProgressBar: true,
            didOpen: (toast) => {
                toast.addEventListener('mouseenter', Swal.stopTimer);
                toast.addEventListener('mouseleave', Swal.resumeTimer);
            }
        });
    </script>
    <!-- Load layout system -->
    <script src="/MaximusHotel/js/layout-loader.js"></script>
</head>
<body>
    <!-- Page Preloder -->
    <div id="preloder">
        <div class="loader"></div>
    </div>
    
    <!-- Layout navigation will be loaded here -->
    <div id="layout-mobilenav-placeholder"></div>
    <div id="layout-navbar-placeholder"></div>
<!-- Breadcrumb Section Begin -->
<div class="breadcrumb-section">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="breadcrumb-text">
                    <h2>Our Rooms</h2>
                    <div class="bt-option">
                        <a href="/MaximusHotel/index.html">Home</a>
                        <span>Rooms</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Breadcrumb Section End -->


<!-- Rooms Section Begin -->
<section class="rooms-section spad">
    <div class="container">
        <div class="row" id="roomsContainer">
            <!-- Rooms will be loaded here via JavaScript -->
        </div>
        <div class="row">
            <div class="col-lg-12">
                <div class="room-pagination d-flex justify-content-center flex-wrap" id="paginationContainer">
                    <!-- Pagination will be loaded here via JavaScript -->
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Rooms Section End -->
<!-- Layout footer will be loaded here -->
<div id="layout-footer-placeholder"></div>

<!-- Js Plugins -->
<script src="/MaximusHotel/js/jquery-3.3.1.min.js"></script>
<script src="/MaximusHotel/js/bootstrap.min.js"></script>
<script src="/MaximusHotel/js/jquery.magnific-popup.min.js"></script>
<script src="/MaximusHotel/js/jquery.nice-select.min.js"></script>
<script src="/MaximusHotel/js/jquery-ui.min.js"></script>
<script src="/MaximusHotel/js/jquery.slicknav.js"></script>
<script src="/MaximusHotel/js/owl.carousel.min.js"></script>
<script src="/MaximusHotel/js/main.js"></script>
<script src="/MaximusHotel/js/config.js"></script>
<script src="/MaximusHotel/js/auth.js"></script>
<script src="/MaximusHotel/js/pages.js"></script>
<script>
    // Navigation update is now handled by layout-loader.js after layouts are loaded
    
    // Load rooms with pagination
    async function loadRooms() {
        const urlParams = new URLSearchParams(window.location.search);
        const page = parseInt(urlParams.get('page')) || 1;
        const search = urlParams.get('search') || '';
        const checkin = urlParams.get('checkin') || '';
        const checkout = urlParams.get('checkout') || '';
        const roomType = urlParams.get('room_type') || '';
        
        // Validate date range
        if (checkin && checkout) {
            const checkInDate = new Date(checkin);
            const checkOutDate = new Date(checkout);
            if (checkOutDate <= checkInDate) {
                Swal.fire({
                    icon: 'error',
                    title: 'Invalid Date Range',
                    text: 'Check-out date must be after Check-in date.',
                }).then(() => {
                    window.location.href = '/MaximusHotel/index.html';
                });
                return;
            }
        }
        
        try {
            // Use CONFIG to get the API base URL
            const apiBaseUrl = typeof CONFIG !== 'undefined' && CONFIG.getApiBaseUrl ? CONFIG.getApiBaseUrl() : 'https://hotelmaximus.bytevortexz.com/api';
            let apiUrl = `${apiBaseUrl}/pages/get_rooms?page=${page}&items_per_page=6`;
            if (search) apiUrl += `&search=${encodeURIComponent(search)}`;
            if (checkin) apiUrl += `&checkin=${encodeURIComponent(checkin)}`;
            if (checkout) apiUrl += `&checkout=${encodeURIComponent(checkout)}`;
            if (roomType) apiUrl += `&room_type=${encodeURIComponent(roomType)}`;
            
            const response = await fetch(apiUrl);
            const result = await response.json();
            
            console.log('Rooms API response:', result); // Debug
            
            if (result.success && result.data && Array.isArray(result.data)) {
                const container = document.getElementById('roomsContainer');
                container.innerHTML = '';
                
                result.data.forEach(room => {
                    const services = room.services && room.services.length > 30 
                        ? room.services.substring(0, 30) + '...' 
                        : room.services || '';
                    
                    const price = parseFloat(room.price).toLocaleString('en-US', {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2
                    });
                    
                    // Ensure image path is valid
                    const roomImage = (room.image && room.image.trim()) ? room.image.trim() : 'default.jpg';
                    const imagePath = `/img/room/${roomImage}`;
                    
                    const roomHtml = `
                        <div class="col-lg-4 col-md-6">
                            <div class="room-item">
                                <img src="${imagePath}" alt="" height="250" onerror="this.src='/img/room/default.jpg'">
                                <div class="ri-text">
                                    <h4>Room ${room.room_id} (${room.category_name})</h4>
                                    <h3>â‚±${price}<span>/Pernight</span></h3>
                                    <table>
                                        <tbody>
                                            <tr>
                                                <td class="r-o">Size:</td>
                                                <td>30 ft</td>
                                            </tr>
                                            <tr>
                                                <td class="r-o">Capacity:</td>
                                                <td>${room.capacity} Person</td>
                                            </tr>
                                            <tr>
                                                <td class="r-o">Bed:</td>
                                                <td>${room.bed || ''}</td>
                                            </tr>
                                            <tr>
                                                <td class="r-o">Services:</td>
                                                <td>${services}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <a href="/MaximusHotel/room-details.html?room_id=${room.room_id}" class="primary-btn">More Details</a>
                                </div>
                            </div>
                        </div>
                    `;
                    container.innerHTML += roomHtml;
                });
                
                // Render pagination
                renderPagination(result.pagination);
            } else {
                document.getElementById('roomsContainer').innerHTML = 
                    '<div class="col-12"><p class="text-center">No rooms available at the moment.</p></div>';
            }
        } catch (error) {
            console.error('Error loading rooms:', error);
            document.getElementById('roomsContainer').innerHTML = 
                '<div class="col-12"><p class="text-center text-danger">Error loading rooms. Please try again later.</p></div>';
        }
    }
    
    function renderPagination(pagination) {
        const container = document.getElementById('paginationContainer');
        if (!pagination || pagination.total_pages <= 1) {
            container.innerHTML = '';
            return;
        }
        
        const currentPage = pagination.current_page;
        const totalPages = pagination.total_pages;
        const urlParams = new URLSearchParams(window.location.search);
        
        let paginationHtml = '';
        
        // Previous button
        if (currentPage > 1) {
            urlParams.set('page', currentPage - 1);
            paginationHtml += `<a href="?${urlParams.toString()}"><i class="fa fa-long-arrow-left"></i> Prev</a>`;
        }
        
        // Page numbers
        if (totalPages <= 5) {
            for (let i = 1; i <= totalPages; i++) {
                urlParams.set('page', i);
                const activeClass = currentPage === i ? 'active' : '';
                paginationHtml += `<a class="${activeClass}" href="?${urlParams.toString()}">${i}</a>`;
            }
        } else {
            if (currentPage <= 3) {
                for (let i = 1; i <= 3; i++) {
                    urlParams.set('page', i);
                    const activeClass = currentPage === i ? 'active' : '';
                    paginationHtml += `<a class="${activeClass}" href="?${urlParams.toString()}">${i}</a>`;
                }
                paginationHtml += `<a href="#!">...</a>`;
                urlParams.set('page', totalPages);
                paginationHtml += `<a href="?${urlParams.toString()}">${totalPages}</a>`;
            } else if (currentPage >= totalPages - 2) {
                urlParams.set('page', 1);
                paginationHtml += `<a href="?${urlParams.toString()}">1</a>`;
                paginationHtml += `<a href="#!">...</a>`;
                for (let i = totalPages - 2; i <= totalPages; i++) {
                    urlParams.set('page', i);
                    const activeClass = currentPage === i ? 'active' : '';
                    paginationHtml += `<a class="${activeClass}" href="?${urlParams.toString()}">${i}</a>`;
                }
            } else {
                urlParams.set('page', 1);
                paginationHtml += `<a href="?${urlParams.toString()}">1</a>`;
                paginationHtml += `<a href="#!">...</a>`;
                for (let i = currentPage - 1; i <= currentPage + 1; i++) {
                    urlParams.set('page', i);
                    const activeClass = currentPage === i ? 'active' : '';
                    paginationHtml += `<a class="${activeClass}" href="?${urlParams.toString()}">${i}</a>`;
                }
                paginationHtml += `<a href="#!">...</a>`;
                urlParams.set('page', totalPages);
                paginationHtml += `<a href="?${urlParams.toString()}">${totalPages}</a>`;
            }
        }
        
        // Next button
        if (currentPage < totalPages) {
            urlParams.set('page', currentPage + 1);
            paginationHtml += `<a href="?${urlParams.toString()}">Next <i class="fa fa-long-arrow-right"></i></a>`;
        }
        
        container.innerHTML = paginationHtml;
    }
    
    // Load rooms on page load
    loadRooms();
</script>
</body>
</html>



